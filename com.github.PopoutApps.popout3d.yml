app-id: com.github.PopoutApps.popout3d

runtime: org.gnome.Platform
runtime-version: "3.38"
sdk: org.gnome.Sdk

command: popout3d
rename-desktop-file: popout3d.desktop
rename-icon: popout3d_logo
copy-icon: true
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --filesystem=host
  
modules:

  - name: python3-pillow
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} Pillow Pillow-PIL
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/3c/7e/443be24431324bd34d22dd9d11cc845d995bcd3b500676bcf23142756975/Pillow-5.4.1.tar.gz
        sha256: 5233664eadfa342c639b9b9977190d64ad7aca4edc51a966394d7e08e7f38a9f
      - type: file
        url: https://files.pythonhosted.org/packages/5d/e1/d298934cd78984a5e8d616945349ed66a74b9df0337fb1941ce76b8a2b7b/Pillow-PIL-0.1dev.tar.gz
        sha256: d80ee30805f10bf898df9ce7495f46e88990e8f90b5c2b917722d87526252b2c

  # align_image_stack deps
  - shared-modules/glew/glew.json
  - shared-modules/glu/glu-9.json

  - name: wxWidgets
    rm-configure: true
    cleanup:
      - /bin
      - /share/bakefile
    config-opts:
      - --with-opengl
      - --with-libjpeg
      - --with-libtiff
      - --with-libpng
      - --with-zlib
      - --disable-sdltest
      - --enable-unicode
      - --enable-display
      - --enable-propgrid
      - --disable-webkit
      - --disable-webview
      - --disable-webviewwebkit
      - --with-expat=builtin
      - --with-libiconv=/usr
    build-options:
      cxxflags: "-std=c++0x"
    sources:
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.5.1/wxWidgets-3.0.5.1.tar.bz2
        sha256: 440f6e73cf5afb2cbf9af10cec8da6cdd3d3998d527598a53db87099524ac807      
    cleanup:
      - /bin
      - /lib
      - /doc
      - /share

  - name: libpano13
    buildsystem: cmake # exalm noted here that cmake-ninja doesn't work OK with libpano13 and __FILE__ macro in its sources
    builddir: true
    sources:
      - type: archive
        url: https://download.sourceforge.net/project/panotools/libpano13/libpano13-2.9.20/libpano13-2.9.20_rc2.tar.gz
        sha256: 6c7184a8af080934252d55e63a0f83457e2b8d59b3b8bb9ad62a21dea82f16cd
    cleanup:
      - /bin
      - /share

  - name: ilmbase
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://github.com/openexr/openexr/releases/download/v2.3.0/ilmbase-2.3.0.tar.gz
        sha256: 456978d1a978a5f823c7c675f3f36b0ae14dba36638aeaa3c4b0e784f12a3862

  - name: openexr
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://github.com/openexr/openexr/releases/download/v2.3.0/openexr-2.3.0.tar.gz
        sha256: fd6cb3a87f8c1a233be17b94c74799e6241d50fc5efd4df75c7a4b9cf4e25ea6
    cleanup:
      - /bin
      - /share/doc

  - name: vigra
    buildsystem: cmake-ninja
    config-opts:
       - -DWITH_OPENEXR=ON
    sources:
      - type: archive
        url: https://github.com/ukoethe/vigra/releases/download/Version-1-11-1/vigra-1.11.1-src.tar.gz
        sha256: a5564e1083f6af6a885431c1ee718bad77d11f117198b277557f8558fa461aaf
    cleanup:
      - /bin
      - /doc
      - /lib/vigra/
      - /share

  - name: exiv2
    buildsystem: cmake
    sources:
      - type: archive
        url: http://www.exiv2.org/builds/exiv2-0.27.2-Source.tar.gz
        sha256: 2652f56b912711327baff6dc0c90960818211cf7ab79bb5e1eb59320b78d153f
    cleanup:
      - /bin
      - /share/man  
    
  - name: boost
    buildsystem: simple
    build-commands:
      - "./bootstrap.sh --prefix=/app --with-libraries=atomic,chrono,date_time,filesystem,iostreams,program_options,system,thread"
      - "./b2 -j $FLATPAK_BUILDER_N_JOBS install"
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.68.0/source/boost_1_68_0.tar.bz2
        sha256: 7f6130bc3cf65f56a618888ce9d5ea704fa10b462be126ad053e80e553d6d8b7
    
  - name: align_image_stack
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/hugin/hugin/hugin-2018.0/hugin-2018.0.0.tar.bz2
        sha256: d3af0d066ac50e3bb243a175a64ecda136d87178419457e8822e11bcf0e565cb
    cleanup:
      - /bin/autooptimiser
      - /bin/calibrate_lens_gui
      - /bin/celeste_standalone
      - /bin/checkpto
      - /bin/cpclean
      - /bin/cpfind
      - /bin/deghosting_mask
      - /bin/fulla
      - /bin/geocpset
      - /bin/hugin*
      - /bin/icpfind
      - /bin/linefind
      - /bin/nona
      - /bin/pano*
      - /bin/PT*
      - /bin/pto_*
      - /bin/tca_correct
      - /bin/verdandi
      - /bin/vig_optimize
      - /lib/libceleste*
      - /lib/libhuginbaswwx*
      - /lib/libicpfindlib*
      - /lib/liblocalfeatures*
      - /share

  - name: popout3d
    buildsystem: meson
    sources:
      - type: git
        tag: submissionB 
        url: https://github.com/PopoutApps/popout3d
